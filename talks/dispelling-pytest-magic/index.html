<!DOCTYPE html>
<html>

    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title>Dispelling py.test magic</title>

        <meta http-equiv="X-Clacks-Overhead" content="GNU John Pinner">
        <link rel="stylesheet" href="/css/main.css">
        
    </head>

    <body class="talks">

        <header class="page-head">
            <div class="wrap">
                <h1><a href="/">PyCon UK 2015</a></h1>
                <label class="menu-icon" for="toggle-nav">Menu</label>
                <input type="checkbox" id="toggle-nav" class="hidden" />
                <nav class="nav">
                    <ul>
                        <li><a href="/schedule/flat/">Schedule</a></li>
                        <li><a href="/venue/">Venue</a></li>
                        <li><a href="/sponsorship/">Sponsor</a></li>
                        <li><a href="/science/">Science</a></li>
                        <li class="halfway"><a href="/education/">Education</a></li>
                        <li><a href="/volunteer/">Volunteer</a></li>
                        <li><a href="/codeofconduct/">CoC</a></li>
                        <li><a class="now" href="/register/">Register</a></li>
                    </ul>
                </nav>
            </div>
        </header>

        
<article class="main-article">
    <div class="content">
        <div class="column_content">
            <h1>Dispelling py.test magic</h1>

            <div class="textblock">
                <h3>Tomek Paczkowski</h3>
<p>This short talk will look under the hood of how py.test uses assertion
statement rewriting to give users a better, more pythonic testing experience. </p>
<p>Usually in Python, assertion statements are quite simple and tedious to work
with, where a simple snippet of code like this:</p>
<div class="codehilite"><pre><span class="n">def</span> <span class="n">double</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="mi">2</span>
<span class="n">expected</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">assert</span> <span class="n">double</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="n">expected</span>
</pre></div>


<p>finishes with message that does not include any context:</p>
<div class="codehilite"><pre><span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="k">last</span><span class="p">):</span>
  <span class="n">File</span> <span class="s">&quot;t.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">5</span><span class="p">,</span> <span class="n">in</span> <span class="sr">&lt;module&gt;</span>
    <span class="n">assert</span> <span class="n">double</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="n">expected</span>
<span class="n">AssertionError</span>
</pre></div>


<p>With py.test, we get a lot more information with all intermittent values nicely
described:</p>
<div class="codehilite"><pre><span class="n">t</span><span class="o">.</span><span class="n">py:5:</span> <span class="n">in</span> <span class="sr">&lt;module&gt;</span>
    <span class="n">assert</span> <span class="n">double</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="n">expected</span>
<span class="n">E</span>   <span class="n">assert</span> <span class="mi">4</span> <span class="o">==</span> <span class="mi">5</span>
<span class="n">E</span>    <span class="o">+</span>  <span class="n">where</span> <span class="mi">4</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">function</span> <span class="n">double</span> <span class="n">at</span> <span class="mh">0x1033add08</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>


<p>During this talk you will learn about all the ingredients needed to
reverse-engineer py.test behaviour, using import hooks described in PEP 302,
and the ast module from standard library. We will try to use these hidden gems
in a broader context, outside of testing.</p>
            </div>
        </div>
    </div>
</article>


        <footer class="page-foot">
            <div class="wrap">
                &copy; 2015. All rights reserved.
            </div>
        </footer>

    </body>

    <!-- Python Powered! --> 
</html>